# Steps: CLI-002

| Field | Value |
|-------|-------|
| Source | [../modules/kindling-cli.aps.md](../modules/kindling-cli.aps.md) |
| Task(s) | CLI-002 â€” Implement search and list commands |
| Created by | @aneki / AI |
| Status | Draft |

## Why This Matters

Users need to query and browse their local memory directly. The search command finds specific content; the list command provides overview of entities. Together they enable inspection and debugging without adapter integration.

## What We're Building

Query commands that:
- Search memory with optional query string
- List capsules, pins, and observations
- Format results for terminal readability
- Support pagination for large datasets

## Prerequisites

- [ ] CLI-001 complete (CLI scaffold exists)
- [ ] RETRIEVAL-001 complete (provider contract defined)
- [ ] STORAGE-004 complete (read helpers available)

## Steps

### 1. Implement search command

- **Why:** Users need to find specific context
- **What:** Search command with query parameter
- **Checkpoint:** `src/cli/commands/search.ts`:
  - Accepts optional query string
  - Accepts --scope flag (session, repo)
  - Calls retrieval orchestrator
  - Returns formatted results
- **Validate:** `pnpm tsc --noEmit`

### 2. Implement search result formatting

- **Why:** Results must be scannable in terminal
- **What:** Human-readable search output
- **Checkpoint:** Search output format:
  - Shows match count
  - Shows tier breakdown (pins, summaries, candidates)
  - Shows snippet preview (truncated)
  - Shows "why" explanation
  - Respects terminal width
- **Validate:** Manual verification

### 3. Implement list capsules command

- **Why:** Users need to see capsule history
- **What:** List command for capsules
- **Checkpoint:** `src/cli/commands/list.ts` handles `list capsules`:
  - Shows capsule ID, type, intent
  - Shows status (open/closed)
  - Shows observation count
  - Shows time range
  - Supports --limit and --offset
- **Validate:** `pnpm tsc --noEmit`

### 4. Implement list pins command

- **Why:** Users need to see what's pinned
- **What:** List command for pins
- **Checkpoint:** `src/cli/commands/list.ts` handles `list pins`:
  - Shows pin ID, target type, target ID
  - Shows reason (if set)
  - Shows TTL/expiration status
  - Shows creation time
- **Validate:** `pnpm tsc --noEmit`

### 5. Implement list observations command

- **Why:** Users need raw observation access
- **What:** List command for observations
- **Checkpoint:** `src/cli/commands/list.ts` handles `list observations`:
  - Shows observation ID, kind
  - Shows truncated content preview
  - Shows timestamp
  - Supports --capsule filter
  - Supports --kind filter
- **Validate:** `pnpm tsc --noEmit`

### 6. Implement pagination

- **Why:** Large datasets need bounded queries
- **What:** Pagination support across list commands
- **Checkpoint:** Pagination:
  - --limit flag (default: 20)
  - --offset flag (default: 0)
  - Shows total count
  - Shows "more results available" hint
- **Validate:** `pnpm tsc --noEmit`

### 7. Implement table formatting

- **Why:** Tables are readable in terminals
- **What:** Table formatter for list output
- **Checkpoint:** `src/cli/output.ts` exports `formatTable()`:
  - Aligns columns
  - Truncates long values
  - Respects terminal width
  - Adds headers
- **Validate:** Manual verification

### 8. Add search tests

- **Why:** Search must return correct results
- **What:** Tests for search command
- **Checkpoint:** `test/cli.search.spec.ts` covers:
  - Empty query returns recent
  - Query matches expected content
  - Scope filtering works
  - --json produces valid output
  - Empty results handled gracefully
- **Validate:** `pnpm test -- cli.search`

### 9. Add list tests

- **Why:** List commands must work correctly
- **What:** Tests for list commands
- **Checkpoint:** `test/cli.list.spec.ts` covers:
  - list capsules shows capsules
  - list pins shows pins
  - list observations shows observations
  - Pagination works
  - Filters work
  - Empty lists handled
- **Validate:** `pnpm test -- cli.list`

## Completion

- [ ] All checkpoints validated
- [ ] Task marked complete in source module

**Completed by:** ___
