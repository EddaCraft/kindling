# Steps: NPM-005

| Field | Value |
|-------|-------|
| Source | [../modules/npm-publishing.aps.md](../modules/npm-publishing.aps.md) |
| Task(s) | NPM-005 â€” Create GitHub Actions publish workflow |
| Created by | @aneki / AI |
| Status | Draft |

## Why This Matters

Automated publishing reduces human error and ensures consistent release process. CI/CD is essential for maintainable open source projects.

## What We're Building

GitHub Actions workflow that:
- Triggers on version tags (v*)
- Runs tests and type-check
- Publishes to npm

## Prerequisites

- [ ] NPM-001 complete (package metadata)
- [ ] NPM-004 complete (publish scripts)
- [ ] GitHub repository exists

## Steps

### 1. Create .github/workflows directory

- **Why:** GitHub Actions location
- **What:** Directory structure
- **Checkpoint:** `.github/workflows/` directory exists
- **Validate:** `ls .github/workflows`

### 2. Create publish.yml workflow

- **Why:** Automated publishing
- **What:** Workflow file
- **Checkpoint:** `.github/workflows/publish.yml` includes:
  - name: Publish to npm
  - on: push tags v*
  - jobs: test, publish
- **Validate:** File exists with correct structure

### 3. Add test job

- **Why:** Quality gate
- **What:** Job that runs tests
- **Checkpoint:** Test job includes:
  - runs-on: ubuntu-latest
  - Node.js setup (v20)
  - pnpm setup
  - Install dependencies
  - Run type-check
  - Run tests
- **Validate:** YAML syntax is valid

### 4. Add publish job

- **Why:** Actual npm publish
- **What:** Job that publishes packages
- **Checkpoint:** Publish job includes:
  - needs: test
  - Node.js and pnpm setup
  - Install dependencies
  - Build
  - Publish with NPM_TOKEN
- **Validate:** YAML syntax is valid

### 5. Document NPM_TOKEN setup

- **Why:** Token needed for publishing
- **What:** Instructions for setting up token
- **Checkpoint:** Comment in workflow or README explains:
  - Create npm access token (automation type)
  - Add as NPM_TOKEN repository secret
  - Required permissions
- **Validate:** Instructions are clear

### 6. Validate workflow syntax

- **Why:** Catch errors before use
- **What:** Syntax validation
- **Checkpoint:** Workflow passes validation:
  ```bash
  # If actionlint is available
  actionlint .github/workflows/publish.yml
  # Or use GitHub's validation
  gh workflow list
  ```
- **Validate:** No syntax errors

## Completion

- [ ] All checkpoints validated
- [ ] Task marked complete in source module

**Completed by:** ___
