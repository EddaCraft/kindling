# Steps: NPM-004

| Field | Value |
|-------|-------|
| Source | [../modules/npm-publishing.aps.md](../modules/npm-publishing.aps.md) |
| Task(s) | NPM-004 â€” Add publish scripts and configuration |
| Created by | @aneki / AI |
| Status | Draft |

## Why This Matters

Publish scripts ensure quality gates (build, test) pass before publishing. Configuration ensures packages publish correctly to npm.

## What We're Building

- Root package.json publish scripts
- .npmrc configuration for public scoped packages

## Prerequisites

- [ ] Build system works (`pnpm run build`)
- [ ] Tests pass (`pnpm run test`)

## Steps

### 1. Add prepublishOnly script

- **Why:** Quality gate before publish
- **What:** Script that runs build and tests
- **Checkpoint:** `package.json` scripts include:
  ```json
  "prepublishOnly": "pnpm run build && pnpm run test && pnpm run type-check"
  ```
- **Validate:** `pnpm run prepublishOnly` succeeds

### 2. Add release script

- **Why:** Streamlined publishing
- **What:** Script to publish all packages
- **Checkpoint:** `package.json` scripts include:
  ```json
  "release": "pnpm -r publish --access public"
  ```
- **Validate:** Script is valid (don't run it)

### 3. Create .npmrc

- **Why:** Configure npm behavior
- **What:** .npmrc with public access
- **Checkpoint:** `.npmrc` contains:
  ```
  access=public
  ```
- **Validate:** File exists

### 4. Verify workspace protocol handling

- **Why:** Ensure internal deps publish correctly
- **What:** Confirm pnpm converts workspace:* on publish
- **Checkpoint:** Documentation or test confirms:
  - workspace:* becomes actual version on publish
  - No manual version updates needed
- **Validate:** `pnpm pack --dry-run` in a package shows correct versions

### 5. Test dry-run publish

- **Why:** Verify publish will work
- **What:** Dry-run across all packages
- **Checkpoint:** All packages can be packed:
  ```bash
  pnpm -r exec pnpm pack --dry-run
  ```
- **Validate:** No errors, reasonable package sizes

## Completion

- [ ] All checkpoints validated
- [ ] Task marked complete in source module

**Completed by:** ___
