# Steps: CLI-003

| Field | Value |
|-------|-------|
| Source | [../modules/kindling-cli.aps.md](../modules/kindling-cli.aps.md) |
| Task(s) | CLI-003 â€” Implement pin management commands |
| Created by | @aneki / AI |
| Status | Draft |

## Why This Matters

Pins mark content that should always be retrieved. Users need to create and remove pins directly without going through an adapter. This is essential for standalone memory management and debugging.

## What We're Building

Pin management commands that:
- Create pins on observations or summaries
- Remove pins by ID
- Support TTL configuration
- Confirm actions clearly

## Prerequisites

- [ ] CLI-001 complete (CLI scaffold exists)
- [ ] STORAGE-002 complete (pin write path available)

## Steps

### 1. Implement pin command

- **Why:** Users need to mark important content
- **What:** Pin command for creating pins
- **Checkpoint:** `src/cli/commands/pin.ts`:
  - Accepts target ID (observation or summary)
  - Accepts --reason flag (optional)
  - Accepts --ttl flag (optional, e.g., "7d", "24h")
  - Creates pin via store
  - Confirms creation with pin ID
- **Validate:** `pnpm tsc --noEmit`

### 2. Implement TTL parsing

- **Why:** TTL needs user-friendly input
- **What:** Duration parser
- **Checkpoint:** `src/cli/utils/duration.ts` exports `parseDuration()`:
  - Accepts: "7d", "24h", "30m", "1w"
  - Returns milliseconds
  - Returns null for invalid input
  - Documented formats
- **Validate:** `pnpm tsc --noEmit`

### 3. Implement target validation

- **Why:** Pins must target existing entities
- **What:** Validation before pin creation
- **Checkpoint:** Pin command validates:
  - Target ID exists in database
  - Target type determined automatically
  - Clear error if target not found
- **Validate:** `pnpm tsc --noEmit`

### 4. Implement unpin command

- **Why:** Users need to remove pins
- **What:** Unpin command for deleting pins
- **Checkpoint:** `src/cli/commands/pin.ts` handles `unpin`:
  - Accepts pin ID
  - Confirms pin exists
  - Deletes pin
  - Confirms deletion
- **Validate:** `pnpm tsc --noEmit`

### 5. Implement pin show command

- **Why:** Users need to inspect pin details
- **What:** Show command for single pin
- **Checkpoint:** `src/cli/commands/pin.ts` handles `pin show <id>`:
  - Shows pin details
  - Shows target content preview
  - Shows TTL/expiration status
  - Shows creation time
- **Validate:** `pnpm tsc --noEmit`

### 6. Add confirmation for destructive actions

- **Why:** Prevent accidental deletion
- **What:** Confirmation prompt
- **Checkpoint:** Unpin command:
  - Prompts "Delete pin X? [y/N]"
  - Respects --yes flag to skip prompt
  - Aborts on non-confirmation
- **Validate:** Manual verification

### 7. Add pin command tests

- **Why:** Pin operations must work correctly
- **What:** Tests for pin commands
- **Checkpoint:** `test/cli.pin.spec.ts` covers:
  - Pin creates pin successfully
  - Pin with TTL sets expiration
  - Pin with reason stores reason
  - Invalid target shows error
  - Unpin removes pin
  - Unpin non-existent shows error
- **Validate:** `pnpm test -- cli.pin`

### 8. Add TTL tests

- **Why:** Duration parsing must be correct
- **What:** Tests for duration parser
- **Checkpoint:** `test/cli.duration.spec.ts` covers:
  - "7d" parses to 7 days
  - "24h" parses to 24 hours
  - "30m" parses to 30 minutes
  - Invalid input returns null
  - Edge cases handled
- **Validate:** `pnpm test -- cli.duration`

## Completion

- [ ] All checkpoints validated
- [ ] Task marked complete in source module

**Completed by:** ___
